FROM python:3.12-slim

RUN apt-get update && apt-get install -y --no-install-recommends \
        iproute2 \
        net-tools \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY requirements.clawsec.txt .
RUN pip install --no-cache-dir -r requirements.clawsec.txt

COPY clawsec-monitor.py .

EXPOSE 8888

# Change from /tmp/clawsec to /home/node
VOLUME ["/home/node"]

RUN useradd -r -u 1001 -g root clawsec
USER clawsec

ENTRYPOINT ["python3", "clawsec-monitor.py"]

CMD ["start"]
